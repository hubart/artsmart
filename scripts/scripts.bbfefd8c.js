"use strict";angular.module("anotareApp",["ngAnimate","ngCookies","LocalStorageModule","ngResource","ngSanitize","ngTouch","ui.router","puElasticInput"]).config(["$stateProvider","$urlRouterProvider",function(a,b){b.otherwise("/main/landing"),a.state("root",{url:"/main",templateUrl:"views/root.html",controller:"RootCtrl"}).state("root.landing",{url:"/landing",parent:"root",controller:"LandingCtrl",templateUrl:"views/landing.html"}).state("root.explore",{url:"/explore",parent:"root",templateUrl:"views/explore.html",controller:"ExploreCtrl"}).state("root.profile",{url:"/profile/{user_id}",parent:"root",templateUrl:"views/profile.html",controller:"ProfileCtrl"}).state("root.artwork",{url:"/artworks/{artwork_id}",parent:"root",templateUrl:"views/annotation.html",controller:"ArtworkCtrl"})}]),angular.module("anotareApp").controller("RootCtrl",["$scope","$http","UserService","AuthService","ArtworkService","$location","$state",function(a,b,c,d,e,f,g){a.login=function(a,b,c){d.login(a,b,c)},a.signup=function(a,b,c){d.signup(a,b,c)},a.logout=function(a,b){d.logout(a,b)},a.isLoggedIn=function(){return d.isLoggedIn()},a.getCurrentUser=function(){return d.getCurrentUser()},a.updateCurrentUser=function(){a.currentUser=a.getCurrentUser(),a.username=a.currentUser.name},a.modalTitle="",a.loggingIn=!1,a.signingUp=!1,a.uploading=!1,a.imageLoaded=!1,a.valid=!1,a.loginName="",a.passwordName="",a.fileToUpload="",a.artworkToUpload={title:"",artists:"",description:"",originLocation:"",medium:"",year:""},a.toggleLogin=function(){a.modalTitle="Log In",a.loggingIn=!a.loggingIn,$("#myModal").modal("show")},a.upload=function(){a.modalTitle="Upload new artwork",a.uploading=!a.uploading,$("#myModal").modal("show")},a.closeModal=function(){a.uploading=!1,a.loggingIn=!1,$("#myModal").modal("hide")},a.addWorkUploadedToUser=function(a,b){c.getSingleUser(a,function(d){var e=d;_.isArray(e.worksUploaded)?e.worksUploaded.push(b):e.worksUploaded=[b],c.put(a,e).then(function(a){})})},a.getAllArtwork=function(a){e.getAll().then(a,function(a){console.log("Failed to get the images, result is :"),console.log(a)})},a.uploadArtwork=function(){console.log("lol"),"string"==typeof a.artworkToUpload.artists&&a.artworkToUpload.artists.trim().length>0&&(a.artworkToUpload.artists=a.artworkToUpload.artists.split(","),a.artworkToUpload.artists.forEach(function(b,c){a.artworkToUpload.artists[c]=b.trim()})),a.artworkToUpload.imageFile=a.fileToUpload,console.log(a.fileToUpload),e.postOne(a.artworkToUpload,function(b){console.log(b),a.closeModal(),a.artworkToUpload={title:"",artists:"",description:"",originLocation:"",medium:"",year:""},a.addWorkUploadedToUser(a.currentUser.id,b._id),g.go("root.artwork",{artwork_id:b._id})},function(a){console.log(a)})},a.navbarLogin=function(){a.login({email:a.loginName,password:a.loginPassword},function(){a.updateCurrentUser(),a.closeModal(),a.loginName="",a.loginPassword="","root.landing"===g.current.name&&g.go("root.explore",{reload:!0})},function(){alert("Wrong credentials")})},a.navbarLogout=function(){a.logout(function(){a.updateCurrentUser(),g.go("root.landing",{},{reload:!0})},function(a){console.log(a)})},a.goToMyProfile=function(){g.go("root.profile",{user_id:a.currentUser.id},{reload:!0})},a.updateCurrentUser()}]),angular.module("anotareApp").controller("LandingCtrl",["$scope","$http","$location","$state",function(a,b,c,d){a.isLoggedIn()&&d.go("root.explore",{},{reload:!0}),a.landingSignup=function(){a.signup({name:a.userName,email:a.userEmail,password:a.userPassword},function(){a.login({email:a.userEmail,password:a.userPassword},function(){a.updateCurrentUser(),a.userName="",a.userPassword="",d.go("root.explore",{reload:!0})},function(){alert("Wrong credentials")})},function(){alert("something went wrong")})}}]),angular.module("anotareApp").controller("ExploreCtrl",["$scope","$http","ArtworkService","$stateParams",function(a,b,c,d){}]),angular.module("anotareApp").controller("ArtworkCtrl",["$scope","$http","ArtworkService","UserService","$stateParams",function(a,b,c,d,e){a.imageScope,a.editMode=!1,a.annotationText="",a.comments,a.safeApply=function(a){var b=this.$root.$$phase;"$apply"==b||"$digest"==b?a&&"function"==typeof a&&a():this.$apply(a)},a.toolIcons=[{url:"images/tool-line.png",name:"line-tool"},{url:"images/tool-square.png",name:"square-tool"},{url:"images/tool-circle.png",name:"circle-tool"},{url:"images/tool-triangle.png",name:"triangle-tool"}],a.getImage=function(b){c.getOne(e.artwork_id).then(function(c){a.imageScope=c.data.data,b()},function(a){console.log("Failed to get the image, result is :"),console.log(a)})},a.updateImage=function(b,d){c.putOne(e.artwork_id,a.imageScope).then(function(a){b&&"function"==typeof b&&b(a.data.data)},function(a){console.log("Failed to get the image, result is :"),console.log(a)})},a.deleteAnnotation=function(a){c.deleteAnnotation(e.artwork_id,a).then(function(a){},function(a){console.log("Failed to delete annotation, result is :"),console.log(a)})},a.addWorkAnnotatedToUser=function(a,b){d.getSingleUser(a,function(c){var e=c;console.log(c),_.isArray(e.worksAnnotated)&&!_.contains(e.worksAnnotated,b)?e.worksAnnotated.push(b):e.worksAnnotated=[b],d.put(a,e)})}}]),angular.module("anotareApp").controller("ProfileCtrl",["$scope","$http","ArtworkService","UserService","$stateParams",function(a,b,c,d,e){function f(){a.annotatedArtworkIds=a.user.worksAnnotated,a.uploadedArtworkIds=a.user.worksUploaded;for(var b=0;b<a.annotatedArtworkIds.length;b++)c.getOne(a.annotatedArtworkIds[b],function(b){a.annotatedArtworks.push(b)},function(a){console.log(a)});for(var b=0;b<a.uploadedArtworkIds.length;b++)c.getOne(a.uploadedArtworkIds[b],function(b){a.uploadedArtworks.push(b)},function(a){console.log(a)})}a.user,a.annotatedArtworks=[],a.uploadedArtworks=[],d.getSingleUser(e.user_id,function(b){console.log(b),a.user=b,console.log(a.user),f()},function(a){console.log(a)})}]),angular.module("anotareApp").directive("displayAnnotation",["$timeout",function(a){return{restrict:"E",replace:!0,templateUrl:"views/display-annotation.html",link:function(b,c,d,e){function f(a){a.frame&&a.frame.remove(),s||(b.imageScope.annotations=_.without(b.imageScope.annotations,_.findWhere(b.imageScope.annotations,{key:a.key})),b.deleteAnnotation(a.key)),a.removeSegments(),a.remove(),a=void 0,b.showAnnotation=!1,s=!1,x=!1,h=void 0,b.annotationHeader="annotation",paper.view.draw()}function g(){b.newComment="",w=!1}b.editMode=!1,b.addMode=!1,b.showAnnotation=!1,b.showDropdown=!0,t=!1,b.currentAnnotation={},b.newComment="",b.annotationHeader="annotation",b.annotationShapes=[];var h,i,j,k,l,m,n,o=b.getCurrentUser(),p=!1,q=!0,r="",s=!1,t=!1,u=!1,v=!1,w=!1,x=!1,y={};b.imageDescription={},$("#main-canvas").on("mouseup",function(a){b.editMode&&!s&&(_.map(b.imageScope.annotations,function(a){if(a._id===h.key){var b=[];_.each(h.segments,function(a){b.push({x:a.point.x/i,y:a.point.y/j})}),a.relativeSegmentPoints=b}}),b.updateImage())});var z=function(){b.imageDescription=_.pick(b.imageScope,"artists","title","description","currentLocation","period","year","originLocation","medium","actualSize"),_.isArray(b.imageDescription.artists)&&(b.imageDescription.artists=b.imageDescription.artists.join(", "));var a=document.getElementById("canvas-image"),a=document.getElementById("canvas-image");a.addEventListener("load",function(){var a=$("#canvas-container");b.canvas=document.getElementById("main-canvas");var c=$("#button-column"),d=this.naturalHeight/this.naturalWidth,e=a.width()*d;a.height(e),c.height(e),paper.setup(b.canvas),b.paper=paper,I()})},A={strokeColor:new paper.Color(.8,.9),strokeWidth:1.5,fillColor:new paper.Color(0,0,0,.2)},B={strokeColor:new paper.Color(.8,.9),strokeWidth:3.5,fillColor:new paper.Color(0,0,0,.2)},C={strokeColor:new paper.Color(.7,.1,.1,1),strokeWidth:2,fillColor:new paper.Color(0,0,0,.1)},D={strokeColor:new paper.Color(.9,.1,.1,1),strokeWidth:3,fillColor:new paper.Color(0,0,0,1e-4)};({strokeColor:new paper.Color(0,0,1,1),strokeWidth:1}),{fillColor:new paper.Color(.2,.2,.8,1),strokeColor:new paper.Color(1,1,1,1),strokeWidth:.3};b.switchEditMode=function(){return b.isLoggedIn()?void(b.editMode&&s&&!b.tryDestroySelectedAnnotation()||(b.addMode&&b.switchAddMode(),b.editMode=!b.editMode,E(),b.editMode&&"undefined"==typeof h&&paper.project.getActiveLayer().children.length>1&&(h=paper.project.getActiveLayer().children[1]),"undefined"!=typeof h&&(b.editMode?h.onMouseDown(null,"force-update"):(h.removeSegments(),h.frame.remove()),paper.view.draw()))):void alert("You have to log in to comment!")},b.switchAddMode=function(){return b.isLoggedIn()?void(b.editMode&&s&&!b.tryDestroySelectedAnnotation()||(b.editMode&&(b.switchEditMode(),k.onClick()),b.addMode=!b.addMode,b.addMode||(l=""))):void alert("You have to log in to comment!")};var E=function(){b.checkIsToolSelected()?$("html,body").css("cursor","crosshair"):$("html,body").css("cursor","default")};b.isEqualToToolSelected=function(a){return l===a},b.selectDrawTool=function(a){l=a,E(),"circle-tool"===a?m={shapeType:"ellipse",comments:[]}:"square-tool"===a?m={shapeType:"rectangle",comments:[]}:"line-tool"===a?m={shapeType:"line",comments:[]}:"triangle-tool"===a&&(m={shapeType:"triangle",comments:[]})};var F=function(a){k=new paper.Raster("canvas-image"),k.on("load",function(){var c=k.getHeight(),d=k.getWidth();j=parseFloat(b.canvas.style.height,10),i=parseFloat(b.canvas.style.width,10);var e=Math.min(j/c,i/d);k.scale(e),k.position=paper.view.center,k.type="main-image",k.onMouseEnter=function(){b.checkIsToolSelected()&&$("html,body").css("cursor","crosshair")},k.onClick=function(a){if((!s||b.tryDestroySelectedAnnotation())&&(b.safeApply(function(){b.showAnnotation=!1}),J(),g(),u=!1,v=!1,b.safeApply(function(){x=!1}),"undefined"!=typeof h&&("line"===h.shapeType?h.style=B:h.style=A,h.active=!1,h.frame&&(h.removeSegments(),h.frame.remove())),b.checkIsToolSelected())){var c=a.point.x-b.canvas.offsetLeft,d=a.point.y-b.canvas.offsetTop;"line-tool"===l?m.relativeSegmentPoints=[{x:(c-25)/i,y:(d+25)/j},{x:(c+25)/i,y:(d-25)/j}]:"triangle-tool"===l?m.relativeSegmentPoints=[{x:(c-25)/i,y:(d+25)/j},{x:(c+25)/i,y:(d+25)/j},{x:c/i,y:(d-13)/j}]:(m.relativeX=c/i,m.relativeY=d/j,m.relativeHeight=.05,m.relativeWidth=.05*j/i),l="",n=b.drawAnnotation(m,"tool"),h=n,b.switchEditMode(),n.onMouseDown(null,"force-update"),b.switchToEditAnnotationText(),b.safeApply(function(){s=!0,b.annotationHeader="adding new annotation",t=!1})}},a()})},G=function(a,b,c){return c.subtract(a).angle-b.subtract(a).angle},H=function(a,b){var c=function(a){var b=a.bounds.clone().expand(5,5);a.frame=new paper.Path.Rectangle(b),a.frame.strokeWidth=1,a.frame.strokeColor="blue",a.frame.insert(2,new paper.Point(b.center.x,b.top)),a.frame.insert(2,new paper.Point(b.center.x,b.top-15)),a.frame.insert(2,new paper.Point(b.center.x,b.top))},d=function(a){a.frame.bottomLeftSegment=new paper.Path.Rectangle({x:a.frame.segments[0].point.x-2.5,y:a.frame.segments[0].point.y-2.5,width:5,height:5,fillColor:"white",strokeColor:"blue",strokeWidth:1,onMouseDrag:function(b){b.point.y<=a.frame.segments[5].point.y+10&&(b.point.y=a.frame.segments[5].point.y+10),b.point.x>=a.frame.segments[5].point.x-10&&(b.point.x=a.frame.segments[5].point.x-10),a.bounds.setBottomLeft(b.point),H(a,"updateAll")},onMouseEnter:function(){$("html,body").css("cursor","nesw-resize")},onMouseLeave:function(){$("html,body").css("cursor","default"),$("html,body").css("cursor","default")}}),a.frame.topLeftSegment=new paper.Path.Rectangle({x:a.frame.segments[1].point.x-2.5,y:a.frame.segments[1].point.y-2.5,width:5,height:5,fillColor:"white",strokeColor:"blue",strokeWidth:1,onMouseDrag:function(b){b.point.y>=a.frame.segments[6].point.y-10&&(b.point.y=a.frame.segments[6].point.y-10),b.point.x>=a.frame.segments[6].point.x-10&&(b.point.x=a.frame.segments[6].point.x-10),a.bounds.setTopLeft(b.point),H(a,"updateAll")},onMouseEnter:function(){$("html,body").css("cursor","nwse-resize")},onMouseLeave:function(){$("html,body").css("cursor","default")}}),a.frame.topRightSegment=new paper.Path.Rectangle({x:a.frame.segments[5].point.x-2.5,y:a.frame.segments[5].point.y-2.5,width:5,height:5,fillColor:"white",strokeColor:"blue",strokeWidth:1,onMouseDrag:function(b){b.point.y>=a.frame.segments[0].point.y-10&&(b.point.y=a.frame.segments[0].point.y-10),b.point.x<=a.frame.segments[0].point.x+10&&(b.point.x=a.frame.segments[0].point.x+10),a.bounds.setTopRight(b.point),H(a,"updateAll")},onMouseEnter:function(){$("html,body").css("cursor","nesw-resize")},onMouseLeave:function(){$("html,body").css("cursor","default")}}),a.frame.bottomRightSegment=new paper.Path.Rectangle({x:a.frame.segments[6].point.x-2.5,y:a.frame.segments[6].point.y-2.5,width:5,height:5,fillColor:"white",strokeColor:"blue",strokeWidth:1,onMouseDrag:function(b){b.point.y<=a.frame.segments[1].point.y+10&&(b.point.y=a.frame.segments[1].point.y+10),b.point.x<=a.frame.segments[1].point.x+10&&(b.point.x=a.frame.segments[1].point.x+10),a.bounds.setBottomRight(b.point),H(a,"updateAll")},onMouseEnter:function(){$("html,body").css("cursor","nwse-resize")},onMouseLeave:function(){$("html,body").css("cursor","default")}}),a.frame.rotateSegment=new paper.Path.Rectangle({x:a.frame.segments[3].point.x-2.5,y:a.frame.segments[3].point.y-2.5,width:5,height:5,fillColor:"white",strokeColor:"blue",strokeWidth:1,onMouseDrag:function(b){var c=G(a.bounds.center,a.frame.segments[3].point,b.point);a.rotate(c),a.frame.rotate(c),H(a,"updateSegments"),a.frame.bottomRightSegment.rotate(c),a.frame.bottomLeftSegment.rotate(c),a.frame.topRightSegment.rotate(c),a.frame.topLeftSegment.rotate(c),a.frame.rotateSegment.rotate(c)},onMouseEnter:function(){$("html,body").css("cursor","all-scroll")},onMouseLeave:function(){$("html,body").css("cursor","default")}})},e=function(){a.frame.bottomLeftSegment.remove(),a.frame.bottomRightSegment.remove(),a.frame.topLeftSegment.remove(),a.frame.topRightSegment.remove(),a.frame.rotateSegment.remove()};a.removeSegments=e,"makeNew"===b?(c(a),d(a)):a.frame&&"updateAll"===b?(e(a),a.frame.remove(),c(a),d(a)):a.frame&&"updateSegments"===b&&(e(a),d(a))};b.drawAnnotation=function(a,c){var d,e=function(a){var c=function(a){b.checkIsToolSelected()||(b.editMode?$("html,body").css("cursor","move"):$("html,body").css("cursor","pointer"),u||(b.showAnnotation=!0,b.safeApply(function(){b.currentAnnotation=_.pick(a,"text","comments","creatorName","dateCreated"),b.comments=a.comments})),a.active||(a.style=C))},d=function(a){b.checkIsToolSelected()||$("html,body").css("cursor","default"),u||b.safeApply(function(){b.showAnnotation=!1}),a.active||("line"===a.shapeType?a.style=B:a.style=A)},e=function(a,c){b.editMode&&($("html,body").css("cursor","move"),a.point.x<k.bounds.x?a.point.x=k.bounds.x:a.point.x>k.bounds.x+k.bounds.width&&(a.point.x=k.bounds.x+k.bounds.width),a.point.y<k.bounds.y?a.point.y=k.bounds.y:a.point.y>k.bounds.y+k.bounds.height&&(a.point.y=k.bounds.y+k.bounds.height),c.position.x+=a.delta.x,c.position.y+=a.delta.y,H(c,"updateAll"))},f=function(a,c,d){var e=!0;return(b.checkIsToolSelected()||s&&c!==n)&&(e=!1,!b.tryDestroySelectedAnnotation())?e:("undefined"!=typeof h&&h!==c&&("line"===h.shapeType?h.style=B:h.style=A,h.active=!1,J(),g(),b.editMode&&(h.removeSegments(),h.frame.remove())),(h!==c||"undefined"!=typeof d&&"force-update"===d)&&(b.showAnnotation=!0,b.safeApply(function(){b.currentAnnotation=_.pick(c,"text","comments","creatorName","dateCreated"),b.comments=c.comments})),b.safeApply(function(){h=c,c.active=!0,c.style=D,u=!0,v=!0,x=!0}),b.editMode&&(c.frame?H(c,"updateAll"):H(c,"makeNew")),e)};a.onMouseDown=function(b,c){return f(b,a,c)},a.onMouseEnter=function(){c(a)},a.onMouseDrag=function(b){e(b,a)},a.onMouseLeave=function(){d(a)}},f=function(b,c){if("undefined"!=typeof c&&"tool"===c){var d=new paper.Path.Rectangle({width:b.relativeWidth*i,height:b.relativeHeight*j,style:A});return d.position.setX(a.relativeX*i),d.position.setY(a.relativeY*j),d}return new paper.Path({segments:b.actualSegments,style:A,closed:!0})},l=function(b,c){if("undefined"!=typeof c&&"tool"===c){var d=new paper.Path.Ellipse({width:b.relativeWidth*i,height:b.relativeHeight*j,style:A});return d.position.setX(a.relativeX*i),d.position.setY(a.relativeY*j),d}var d=new paper.Path({segments:b.actualSegments,closed:!0,style:A});return d.smooth(),d},m=function(a,b){return new paper.Path({segments:a.actualSegments,style:B})},o=function(a,b){return new paper.Path({segments:a.actualSegments,style:A,closed:!0})};return a.actualSegments=[],_.each(a.relativeSegmentPoints,function(b,c){a.actualSegments.push({x:b.x*i,y:b.y*j})}),"rectangle"===a.shapeType?d=f(a,c):"ellipse"===a.shapeType?d=l(a,c):"line"===a.shapeType?d=m(a,c):"triangle"===a.shapeType&&(d=o(a,c)),"undefined"!=typeof d?(d.shapeType=a.shapeType,d.text=a.text,d.dateCreated=a.dateCreated,d.creatorName=a.creatorName,d.comments=a.comments,d.active=!1,d.key=a._id,e(d),d):void console.log("Shape"+a.shapeType+"is unidentified")};var I=function(){F(function(){b.imageScope.annotations.forEach(function(a){b.annotationShapes.push(b.drawAnnotation(a))})})};b.shouldShowDeleteButton=function(){return x},b.switchToEditAnnotationText=function(){b.isLoggedIn()?(t=!0,r=b.currentAnnotation.text,angular.element("#annotation-description > textarea").prop("disabled",!1).focus()):alert("You have to log in to comment!")},b.submitNewAnnotation=function(){if(b.currentAnnotation.text&&b.currentAnnotation.text.trim().length>0){m.text=b.currentAnnotation.text,m.creatorName=o.name,m.creatorId=o.id,m.dateCreated=Date.now(),_.extend(h,m),_.extend(b.currentAnnotation,m);var a=[];_.each(h.segments,function(b){a.push({x:b.point.x/i,y:b.point.y/j})}),m.relativeSegmentPoints=a,b.imageScope.annotations.push(m),b.updateImage(function(a){b.addWorkAnnotatedToUser(o.id,a._id)}),m={},s=!1,t=!1,b.annotationHeader="annotation",b.switchEditMode()}else alert("You can't submit an empty annotation.")},b.cancelEditAnnotationText=function(){t=!1,angular.element("#annotation-description > textarea").prop("disabled",!0),r.trim().length>0&&(b.currentAnnotation.text=r),r=""};var J=function(){r="",b.cancelEditAnnotationText()};b.updateEditAnnotationText=function(){b.currentAnnotation.text.trim().length>0?(t=!1,h.text=b.currentAnnotation.text,angular.element("#annotation-description > textarea").prop("disabled",!0),r="",_.map(b.imageScope.annotations,function(a){a._id===h.key&&(a.text=h.text)}),b.updateImage()):alert("You can't submit an empty annotation.")},b.checkIsToolSelected=function(){return!!l},b.shouldShowSubmitAnnotation=function(){return s},b.shouldShowEditAnnotation=function(){return!t&&!s},b.shouldShowUpdateAnnotation=function(){return t},b.tryDestroySelectedAnnotation=function(){if(!b.isLoggedIn())return void alert("You have to log in to comment!");var a;return a=n===h?"Are you sure you do no want to submit your new annotation?":"Are you sure you want to delete this annotation?",confirm(a)?(f(h),!0):!1},b.shouldShowTextAnnotationTools=function(){return v},b.shouldShowAnnotationComments=function(){return v&&!s},b.shouldShowCommentTextArea=function(){return w},b.showCommentTextArea=function(){b.isLoggedIn()?(w=!0,a(function(){$(".add-comment-textarea").focus()})):alert("You have to log in to comment!")},b.cancelNewComment=function(){g()},b.submitNewComment=function(){"string"==typeof b.newComment&&b.newComment.trim().length>0?(_.map(b.imageScope.annotations,function(a){a._id===h.key&&a.comments.push({text:b.newComment,userName:o.name,userId:o.id,dateCreated:Date.now()})}),b.updateImage(),g()):alert("You can't submit an empty comment.")},b.shouldShowAddAComment=function(){return!w&&!s},b.shouldShowMoreInfo=function(){return!p&&q},b.shouldShowLessInfo=function(){return p&&q},b.shouldShowEditImageDescription=function(){return q},b.showMoreInfo=function(){p=!0},b.showLessInfo=function(){p=!1},b.editImageDescription=function(){b.isLoggedIn()?(y=_.clone(b.imageDescription),q=!1):alert("You have to log in to comment!")},b.updateImageDescription=function(){b.imageDescription.artists=b.imageDescription.artists.split(","),b.imageDescription.artists.forEach(function(a,c){b.imageDescription.artists[c]=a.trim()}),_.extendOwn(b.imageScope,b.imageDescription),b.imageDescription.artists=b.imageDescription.artists.join(", "),b.updateImage(),q=!0},b.cancelImageDescription=function(){_.extendOwn(b.imageDescription,y),q=!0},b.shouldShowDescriptionLabels=function(){return!q},b.shouldShowMoreDescription=function(){return p},b.getImage(z)}}}]).directive("elastic",["$timeout",function(a){return{restrict:"A",require:"ngModel",link:function(b,c){var d=c.controller("ngModel"),e=function(a){if("TEXTAREA"===c.prop("tagName")){var b=c.height(1)[0].scrollHeight;25>b&&(b=25),c.height(b)}else console.warn("directive elastic is only for textarea element")};b.$watch(function(){return d.$modelValue+c.attr("class")},function(){a(e,0)},!1)}}}]),angular.module("anotareApp").directive("photoSlider",["$interval",function(a){return{restrict:"EA",link:function(b){b.currentIndex=0,b.items=[];var c=function(a){a!==b.currentIndex&&(b.headerItems[b.currentIndex].visible=!1,b.headerItems[a].visible=!0,b.currentIndex=a)};b.loadToItem=function(){b.imageScope.forEach(function(a,c){b.items.push(a),b.items[c].visible=!1}),b.items[b.currentIndex].visible=!0},b.next=function(){var a=b.currentIndex<b.headerItems.length-1?b.currentIndex+1:0;c(a)},b.prev=function(){var a=b.currentIndex>0?b.currentIndex-1:b.headerItems.length-1;c(a)},b.setCurrentIndex=function(a){c(a)},b.isCurrentIndex=function(a){return b.currentIndex===a},b.getAllArtwork(function(c){b.imageScope=c.data.data,b.loadToItem(),a(b.next,5e3)})}}}]),angular.module("anotareApp").directive("parallax",function(){return{restrict:"A",replace:!0,scope:{offset:"@offsetParallax",direction:"@directionParallax"},link:function(a,b,c,d){var e={x:-1,y:-1},f=Number(b.css("margin-top").replace(/[^-\d\.]/g,"")),g=Number(b.css("margin-left").replace(/[^-\d\.]/g,"")),h=Number(b[0].style.width.replace(/[^-\d\.]/g,"")),i=Number(b[0].style.height.replace(/[^-\d\.]/g,"")),j=$(window).height()-i/2+10,k=$(window).width()-h/2;$(document).mousemove(function(c){if(e.x=c.pageX,e.y=c.pageY,"reverse"===a.direction)var d=f-(e.y-j)/j*a.offset,h=g-(e.x-k)/k*a.offset;else var d=f+(e.y-j)/j*a.offset,h=g+(e.x-k)/k*a.offset;b.css({"margin-top":d+"px","margin-left":h+"px"})})}}}),angular.module("anotareApp").directive("horizontalInfinityScroll",function(){return{restrict:"EA",link:function(a,b,c){var d,e=b[0],f=!1;a.scrollRight=function(){f=!0,d=window.setInterval(function(){f&&$(e).animate({scrollLeft:"+=20"},100)},100)},a.scrollEnd=function(){window.clearInterval(d),f=!1},a.scrollLeft=function(){f=!0,d=window.setInterval(function(){f&&$(e).animate({scrollLeft:"-=20"},100)},100)},b.bind("scroll",function(){e.scrollLeft+e.offsetWidth>=e.scrollWidth&&a.$apply(c.horizontalInfinityScroll)})}}}),angular.module("anotareApp").directive("navigationBar",function(){return{restrict:"E",templateUrl:"views/navigation-bar.html",link:function(a,b,c,d){}}}),angular.module("anotareApp").directive("dropbox",function(){return{restrict:"A",link:function(a,b){a.uploadImgSrc="images/graybox.jpg",b.bind("error",function(){a.fileToUpload=""}),b.bind("dragover",function(a){a.stopPropagation(),a.preventDefault()}),b.bind("dragenter",function(c){c.stopPropagation(),c.preventDefault(),a.$apply(function(){b.addClass("highlight-border")})}),b.bind("dragleave",function(c){c.stopPropagation(),c.preventDefault(),a.$apply(function(){b.removeClass("highlight-border")})}),b.bind("drop",function(c){var d=[];d=c.dataTransfer?c.dataTransfer.files[0]:c.originalEvent.dataTransfer.files[0],c.stopPropagation(),c.preventDefault();var e=new FileReader;e.onload=function(c){a.$apply(function(){b.removeClass("highlight-border"),a.$parent.fileToUpload=c.target.result,$("#imgDrop").css("background-image","url("+a.$parent.fileToUpload+")"),a.urlValue=""})},e.readAsDataURL(d)})}}}),angular.module("anotareApp").directive("filebrowse",[function(){return{restrict:"A",scope:{fileread:"="},link:function(a,b,c){b.bind("change",function(b){var c=new FileReader;c.onload=function(b){a.$apply(function(){a.$parent.fileToUpload=b.target.result,$("#imgDrop").css("background-image","url("+a.$parent.fileToUpload+")"),a.urlValue=""})},c.readAsDataURL(b.target.files[0])})}}}]),angular.module("anotareApp").config(["$compileProvider",function(a){a.imgSrcSanitizationWhitelist();a.imgSrcSanitizationWhitelist(/^\s*(https?|ftp|file|blob):|data:image\//)}]).directive("imgurl",["$http",function(a){return{restrict:"A",link:function(b,c,d){b.validateUrl=function(){var c={headers:{"Content-Type":"application/x-www-form-urlencoded"}};""!==b.urlValue?a({method:"GET",url:b.urlValue,responseType:"blob",headers:c,withCredentials:!0}).then(function(a){var c=a.headers("Content-type");if(c.match("image/.+")){b.valid=!0;var d=new window.FileReader;d.readAsDataURL(a.data),d.onloadend=function(){b.fileToUpload=d.result}}},function(a){console.log("failed")}):b.fileToUpload=""}}}}]),angular.module("anotareApp").factory("UserService",["$http",function(a){var b="http://192.241.182.160:4000/api/",c={headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"}},d={getAllUsers:function(){return a.get(b+"users/")},getSingleUser:function(c,d,e){var f=b+"users/"+c;a.get(f).success(function(a){d&&"function"==typeof d&&d(a.data)}).error(function(a){a&&"function"==typeof a&&a()})},post:function(c){return a.post(b+"users/",$.param(c))},put:function(d,e){return a.put(b+"users/"+d,$.param(e),c)},"delete":function(c){return a["delete"](b+"users/"+c)}};return d}]),angular.module("anotareApp").factory("AuthService",["localStorageService","$http",function(a,b){function c(b){d=b,a.set("user",b)}var d=a.get("user")||{},e="http://192.241.182.160:4000/api/",f={headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"}};return{isLoggedIn:function(a){return!_.isEmpty(d)},logout:function(a,d){b["delete"](e+"logout").success(function(){c({}),a&&"function"==typeof a&&a()}).error(function(){d&&"function"==typeof d&&d()})},login:function(a,d,g){b.post(e+"login/",$.param(a),f).success(function(a){c(a),d&&"function"==typeof d&&d(a)}).error(function(){g&&"function"==typeof g&&g()})},signup:function(a,d,f){b.post(e+"signup/",a).success(function(a){c(a),d&&"function"==typeof d&&d(a)}).error(function(){f&&"function"==typeof f&&f()})},getCurrentUser:function(){return d}}}]),angular.module("anotareApp").factory("ArtworkService",["$http",function(a){var b="http://192.241.182.160:4000/api",c={headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"}};return{getAll:function(){return a.get(b+"/artworks/")},getOne:function(c,d,e){return a.get(b+"/artworks/"+c).success(function(a){console.log(a),d&&"function"==typeof d&&d(a.data)}).error(function(a){a&&"function"==typeof a&&a()})},postOne:function(d,e,f){return a.post(b+"/artworks",$.param(d),c).success(function(a){e&&"function"==typeof e&&e(a.data)}).error(function(a){a&&"function"==typeof a&&a()})},deleteOne:function(c){return a["delete"](b+"/artworks/"+c)},putOne:function(d,e){return a.put(b+"/artworks/"+d,$.param(e),c)},deleteAnnotation:function(c,d){return a["delete"](b+"/artworks/"+c+"/annotations/"+d)}}}]);